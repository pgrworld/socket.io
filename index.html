<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CHAT APPLICATION</title>
<!--   <link rel="stylesheet" type="text/css" href="/theme.css">  -->
  <style>
    .chat-form { display: none; }
    body {
      background-color:lightgreen;
    }
  </style>
</head>
<body>
<h1> Chat Application </h1>

  <form class="username-form" method="post" action="">
  <label >USERNAME*: </label>
  <input id="username" type="text" required/>
  <input type="submit" value="Join" />
  <input type="reset" value="cancel" />
  </form>

<form class="chat-form" method="post" action="">
  <div>Hey there, <span id="output1"></span></div>
  <label>To:</label> <input id="recipient" type="text"/><br />
  <label>Message: </label><br /> 
  <textarea id="message"></textarea> 
  <input type="submit" value="Send" />
  <input type="reset" value="cancel" />
  <input type = "button" onclick = "userlist()" id="output1" value = "previous msgs" /> 
  <ul id="messages">
  </ul>
</form>

 <p id="output"></p>


<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

  <script>
  var socket = io.connect('http://localhost:3000');
  var user = ""
  $(".username-form").on("submit", function(){
    
   var username=$(this).children("input").val();
  // document.getElementById("demo").innerHTML=array;
   user=username
   socket.emit("add-user", {"username": username});  
    // Remove this form and show the chat form 
    $(this).remove();
    $("#username").text(username);
    chat_form.show();
     // socket.on('output', function(data){
     // var output1 = data
    // document.getElementById('output').innerHTML = output;
    return false;
 });

   //   socket.on('output', function(data){ 
   //   document.getElementById('output').innerHTML = data;
   // }

  //  function userlist(){
  //   //var output1=""
  //  document.getElementById('output').innerHTML = output1;
  // };

  // Chat form
 var chat_form = $(".chat-form");
 chat_form.on("submit", function(){
   // Send the message to the server
   socket.emit("private-message", {
    "username": $(this).find("input:first").val(),
    "content": $(this).find("textarea").val(),
    "text":user
   });
      
   // Empty the form
   $(this).find("input:first, textarea").val('');
   return false;
 });

 // Whenever we receieve a message, append it to the <ul>
   socket.on("add-message", function(data,array,output){
   $("#messages").append($("<li>", {
   "text":data.text+":"+data.content+" "+ " USERSLIST: "+array+" "+"previous msg:"+output
   }));
  });

</script>
</body>
</html>



